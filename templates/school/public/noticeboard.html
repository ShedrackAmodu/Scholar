{% extends 'base.html' %}
{% load static %}

{% block title %}Noticeboard - {{ block.super }}{% endblock %}

{% block extra_css %}
<style>
    /* Noticeboard Hero */
    .noticeboard-hero {
        position: relative;
        min-height: 300px;
        background: linear-gradient(135deg, rgba(255, 105, 180, 0.9), rgba(255, 20, 147, 0.9)), url('https://images.unsplash.com/photo-1456513080510-7bf3a84b82f8?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
        background-size: cover;
        background-position: center;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        text-align: center;
        margin-top: -76px;
        padding-top: 76px;
    }

    /* Filters */
    .filters-section {
        padding: 40px 0 20px;
    }

    .filter-card {
        background: var(--card-bg);
        border-radius: 15px;
        padding: 20px;
        box-shadow: var(--shadow);
        backdrop-filter: blur(10px);
        border: var(--border);
    }

    .filter-group {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    .filter-btn {
        padding: 8px 20px;
        border-radius: 25px;
        border: 2px solid var(--primary-pink);
        background: transparent;
        color: var(--text-primary);
        font-weight: 500;
        transition: var(--transition-smooth);
        cursor: pointer;
    }

    .filter-btn:hover,
    .filter-btn.active {
        background: linear-gradient(135deg, var(--primary-pink), var(--dark-pink));
        color: white;
        border-color: transparent;
        transform: translateY(-2px);
    }

    .search-box {
        position: relative;
    }

    .search-box input {
        width: 100%;
        padding: 12px 20px 12px 45px;
        border-radius: 25px;
        border: 2px solid transparent;
        background: var(--card-bg);
        color: var(--text-primary);
        transition: var(--transition-smooth);
    }

    .search-box input:focus {
        border-color: var(--primary-pink);
        box-shadow: 0 0 0 4px rgba(255, 105, 180, 0.1);
    }

    .search-box i {
        position: absolute;
        left: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--primary-pink);
    }

    /* Notice Cards */
    .noticeboard-section {
        padding: 40px 0 80px;
    }

    .notice-item {
        background: var(--card-bg);
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 25px;
        box-shadow: var(--shadow);
        transition: var(--transition-bounce);
        position: relative;
        overflow: hidden;
        border-left: 5px solid transparent;
        backdrop-filter: blur(10px);
        border: var(--border);
    }

    .notice-item:hover {
        transform: translateX(15px) translateY(-5px);
        box-shadow: 0 20px 40px rgba(255, 105, 180, 0.2);
    }

    .notice-item.pinned {
        border-left-color: var(--warning);
        background: linear-gradient(135deg, var(--card-bg), rgba(253, 203, 110, 0.1));
    }

    .notice-item.urgent {
        border-left-color: var(--danger);
        animation: pulse-border 2s infinite;
    }

    @keyframes pulse-border {
        0%, 100% { border-left-color: var(--danger); }
        50% { border-left-color: transparent; }
    }

    .notice-badge {
        position: absolute;
        top: 20px;
        right: 20px;
        padding: 5px 15px;
        border-radius: 25px;
        font-size: 0.8rem;
        font-weight: 600;
        text-transform: uppercase;
    }

    .badge-pinned {
        background: var(--warning);
        color: #000;
    }

    .badge-urgent {
        background: var(--danger);
        color: white;
    }

    .notice-header {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 20px;
        flex-wrap: wrap;
    }

    .notice-type {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 5px 15px;
        background: rgba(255, 105, 180, 0.1);
        color: var(--primary-pink);
        border-radius: 25px;
        font-size: 0.9rem;
        font-weight: 500;
    }

    .notice-date {
        color: var(--text-secondary);
        font-size: 0.9rem;
    }

    .notice-date i {
        color: var(--primary-pink);
        margin-right: 5px;
    }

    .notice-title {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 15px;
        color: var(--text-primary);
        line-height: 1.4;
    }

    .notice-content {
        color: var(--text-secondary);
        margin-bottom: 20px;
        line-height: 1.8;
    }

    .notice-meta {
        display: flex;
        align-items: center;
        gap: 30px;
        margin-bottom: 20px;
        color: var(--text-secondary);
        font-size: 0.95rem;
    }

    .notice-meta i {
        color: var(--primary-pink);
        margin-right: 5px;
    }

    .notice-footer {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding-top: 20px;
        border-top: var(--border);
    }

    .read-more {
        color: var(--primary-pink);
        text-decoration: none;
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        transition: var(--transition-smooth);
    }

    .read-more:hover {
        color: var(--dark-pink);
        gap: 15px;
    }

    .share-buttons {
        display: flex;
        gap: 10px;
    }

    .share-btn {
        width: 35px;
        height: 35px;
        border-radius: 50%;
        background: rgba(255, 105, 180, 0.1);
        color: var(--text-secondary);
        display: flex;
        align-items: center;
        justify-content: center;
        text-decoration: none;
        transition: var(--transition-bounce);
    }

    .share-btn:hover {
        background: linear-gradient(135deg, var(--primary-pink), var(--dark-pink));
        color: white;
        transform: translateY(-3px) rotate(360deg);
    }

    /* Pagination */
    .pagination-section {
        padding: 40px 0;
    }

    .pagination {
        display: flex;
        justify-content: center;
        gap: 10px;
        flex-wrap: wrap;
    }

    .page-link {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--card-bg);
        color: var(--text-primary);
        text-decoration: none;
        transition: var(--transition-bounce);
        border: 2px solid transparent;
    }

    .page-link:hover,
    .page-link.active {
        background: linear-gradient(135deg, var(--primary-pink), var(--dark-pink));
        color: white;
        transform: translateY(-3px);
        box-shadow: 0 10px 20px rgba(255, 105, 180, 0.3);
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 80px 20px;
    }

    .empty-icon {
        font-size: 5rem;
        color: var(--primary-pink);
        margin-bottom: 20px;
        opacity: 0.5;
    }

    .empty-state h3 {
        font-size: 2rem;
        font-weight: 600;
        margin-bottom: 15px;
        color: var(--text-primary);
    }

    .empty-state p {
        color: var(--text-secondary);
        margin-bottom: 30px;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .notice-title {
            font-size: 1.2rem;
        }

        .notice-header {
            gap: 10px;
        }

        .notice-meta {
            flex-direction: column;
            gap: 10px;
            align-items: flex-start;
        }

        .notice-footer {
            flex-direction: column;
            gap: 15px;
            align-items: flex-start;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="noticeboard-hero">
    <div class="container">
        <h1 class="display-4 fw-bold animate__animated animate__fadeInUp">Noticeboard</h1>
        <p class="lead animate__animated animate__fadeInUp animate__delay-1s">
            Stay updated with the latest announcements and information
        </p>
    </div>
</section>

<!-- Filters Section -->
<section class="filters-section">
    <div class="container">
        <div class="filter-card" data-aos="fade-up">
            <div class="row g-4">
                <div class="col-md-8">
                    <div class="filter-group">
                        <button class="filter-btn active" data-filter="all">All Notices</button>
                        <button class="filter-btn" data-filter="GEN">General</button>
                        <button class="filter-btn" data-filter="ACAD">Academic</button>
                        <button class="filter-btn" data-filter="ADMIN">Administrative</button>
                        <button class="filter-btn" data-filter="EMER">Emergency</button>
                        <button class="filter-btn" data-filter="HOL">Holiday</button>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchInput" placeholder="Search notices...">
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Notice List -->
<section class="noticeboard-section">
    <div class="container">
        <div class="notice-list" id="noticeList">
            {% for notice in notices %}
            <div class="notice-item {% if notice.is_pinned %}pinned{% endif %} {% if notice.priority == 'URG' %}urgent{% endif %}" 
                 data-aos="fade-up"
                 data-type="{{ notice.notice_type }}"
                 data-title="{{ notice.title|lower }}"
                 data-content="{{ notice.content|lower }}">
                
                {% if notice.is_pinned %}
                <div class="notice-badge badge-pinned">
                    <i class="fas fa-thumbtack me-1"></i> Pinned
                </div>
                {% endif %}
                
                {% if notice.priority == 'URG' %}
                <div class="notice-badge badge-urgent">
                    <i class="fas fa-exclamation-circle me-1"></i> Urgent
                </div>
                {% endif %}

                <div class="notice-header">
                    <span class="notice-type">
                        <i class="fas fa-{% if notice.notice_type == 'GEN' %}bullhorn{% elif notice.notice_type == 'ACAD' %}book{% elif notice.notice_type == 'ADMIN' %}cog{% elif notice.notice_type == 'EMER' %}exclamation-triangle{% elif notice.notice_type == 'HOL' %}umbrella-beach{% endif %}"></i>
                        {{ notice.get_notice_type_display }}
                    </span>
                    <span class="notice-date">
                        <i class="far fa-calendar-alt"></i>
                        {{ notice.publish_date|date:"F d, Y" }}
                    </span>
                </div>

                <h2 class="notice-title">{{ notice.title }}</h2>
                <p class="notice-content">{{ notice.content|truncatechars:200 }}</p>

                <div class="notice-meta">
                    <span>
                        <i class="far fa-user"></i>
                        Posted by: {{ notice.created_by.get_full_name|default:"Administrator" }}
                    </span>
                    <span>
                        <i class="far fa-eye"></i>
                        {{ notice.view_count }} views
                    </span>
                    {% if notice.attachment %}
                    <span>
                        <i class="fas fa-paperclip"></i>
                        Attachment available
                    </span>
                    {% endif %}
                </div>

                <div class="notice-footer">
                    <a href="{% url 'announcements:notice_detail' notice.id %}" class="read-more">
                        Read Full Notice <i class="fas fa-arrow-right"></i>
                    </a>
                    <div class="share-buttons">
                        <a href="#" class="share-btn" title="Share on Facebook" onclick="shareOnFacebook('{{ notice.title }}')">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="#" class="share-btn" title="Share on Twitter" onclick="shareOnTwitter('{{ notice.title }}')">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="#" class="share-btn" title="Share via Email" onclick="shareByEmail('{{ notice.title }}')">
                            <i class="fas fa-envelope"></i>
                        </a>
                        <a href="#" class="share-btn" title="Print Notice" onclick="window.print()">
                            <i class="fas fa-print"></i>
                        </a>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="empty-state" data-aos="fade-up">
                <div class="empty-icon">
                    <i class="fas fa-clipboard-list"></i>
                </div>
                <h3>No Notices Yet</h3>
                <p>There are currently no notices to display. Please check back later.</p>
            </div>
            {% endfor %}
        </div>

        <!-- Pagination -->
        {% if is_paginated %}
        <div class="pagination-section" data-aos="fade-up">
            <div class="pagination">
                {% if page_obj.has_previous %}
                <a href="?page={{ page_obj.previous_page_number }}" class="page-link">
                    <i class="fas fa-chevron-left"></i>
                </a>
                {% endif %}

                {% for num in page_obj.paginator.page_range %}
                    {% if page_obj.number == num %}
                    <a href="?page={{ num }}" class="page-link active">{{ num }}</a>
                    {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                    <a href="?page={{ num }}" class="page-link">{{ num }}</a>
                    {% endif %}
                {% endfor %}

                {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}" class="page-link">
                    <i class="fas fa-chevron-right"></i>
                </a>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>
</section>

<!-- Subscribe Section -->
<section class="py-5" style="background: linear-gradient(135deg, var(--primary-pink), var(--dark-pink)); color: white;">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8" data-aos="fade-right">
                <h2 class="display-6 fw-bold mb-3">Never Miss an Update</h2>
                <p class="lead mb-0">Subscribe to receive notifications about new notices and announcements</p>
            </div>
            <div class="col-lg-4" data-aos="fade-left">
                <form class="subscribe-form" id="subscribeForm">
                    {% csrf_token %}
                    <div class="input-group">
                        <input type="email" class="form-control" placeholder="Enter your email" required>
                        <button class="btn btn-light" type="submit">
                            <i class="fas fa-bell me-2"></i>Subscribe
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    $(document).ready(function() {
        // Filter functionality
        $('.filter-btn').on('click', function() {
            const filter = $(this).data('filter');
            
            // Update active state
            $('.filter-btn').removeClass('active');
            $(this).addClass('active');
            
            // Filter notices
            if (filter === 'all') {
                $('.notice-item').show();
            } else {
                $('.notice-item').each(function() {
                    const type = $(this).data('type');
                    if (type === filter) {
                        $(this).show();
                    } else {
                        $(this).hide();
                    }
                });
            }
        });

        // Search functionality
        $('#searchInput').on('keyup', function() {
            const searchTerm = $(this).val().toLowerCase();
            
            $('.notice-item').each(function() {
                const title = $(this).data('title');
                const content = $(this).data('content');
                
                if (title.includes(searchTerm) || content.includes(searchTerm)) {
                    $(this).show();
                } else {
                    $(this).hide();
                }
            });
        });

        // Subscribe form
        $('#subscribeForm').on('submit', function(e) {
            e.preventDefault();
            const email = $(this).find('input[type="email"]').val();
            
            // Animate button
            const btn = $(this).find('button');
            btn.html('<i class="fas fa-spinner fa-spin"></i> Subscribing...');
            btn.prop('disabled', true);
            
            // Simulate subscription
            setTimeout(() => {
                btn.html('<i class="fas fa-check"></i> Subscribed!');
                showNotification('Successfully subscribed to notifications!', 'success');
                
                setTimeout(() => {
                    btn.html('<i class="fas fa-bell me-2"></i>Subscribe');
                    btn.prop('disabled', false);
                    $(this).find('input[type="email"]').val('');
                }, 2000);
            }, 1500);
        });

        // Lazy load images
        const images = document.querySelectorAll('img[data-src]');
        const imageObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const img = entry.target;
                    img.src = img.dataset.src;
                    img.classList.add('animate__animated', 'animate__fadeIn');
                    observer.unobserve(img);
                }
            });
        });

        images.forEach(img => imageObserver.observe(img));

        // Infinite scroll (optional)
        let loading = false;
        $(window).on('scroll', function() {
            if ($(window).scrollTop() + $(window).height() > $(document).height() - 100) {
                if (!loading && $('.pagination .next').length) {
                    loading = true;
                    const nextUrl = $('.pagination .next').attr('href');
                    if (nextUrl) {
                        // Load next page via AJAX
                        $.get(nextUrl, function(data) {
                            const newNotices = $(data).find('.notice-item');
                            $('#noticeList').append(newNotices);
                            loading = false;
                            
                            // Update pagination
                            const newPagination = $(data).find('.pagination');
                            $('.pagination-section').html(newPagination);
                        });
                    }
                }
            }
        });
    });

    // Share functions
    function shareOnFacebook(title) {
        const url = encodeURIComponent(window.location.href);
        const shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}&quote=${encodeURIComponent(title)}`;
        window.open(shareUrl, '_blank', 'width=600,height=400');
    }

    function shareOnTwitter(title) {
        const url = encodeURIComponent(window.location.href);
        const text = encodeURIComponent(title);
        const shareUrl = `https://twitter.com/intent/tweet?url=${url}&text=${text}`;
        window.open(shareUrl, '_blank', 'width=600,height=400');
    }

    function shareByEmail(title) {
        const subject = encodeURIComponent(`Check out this notice: ${title}`);
        const body = encodeURIComponent(`I thought you might be interested in this notice: ${window.location.href}`);
        window.location.href = `mailto:?subject=${subject}&body=${body}`;
    }
</script>
{% endblock %}