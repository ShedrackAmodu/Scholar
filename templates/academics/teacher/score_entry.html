{% extends 'base.html' %}
{% load static %}

{% block title %}Score Entry - Teacher{% endblock %}

{% block extra_css %}
<style>
    /* Page Header */
    .page-header {
        background: linear-gradient(135deg, #6c5ce7, #a363d9);
        padding: 50px 0;
        margin-bottom: 40px;
        border-radius: 0 0 50px 50px;
        color: white;
        position: relative;
        overflow: hidden;
    }

    .page-header::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -30%;
        width: 400px;
        height: 400px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        animation: float 20s ease-in-out infinite;
    }

    .header-content {
        position: relative;
        z-index: 2;
    }

    .header-title {
        font-family: 'Playfair Display', serif;
        font-size: 2.8rem;
        font-weight: 700;
        margin-bottom: 15px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
    }

    .header-subtitle {
        font-size: 1.2rem;
        opacity: 0.95;
    }

    /* Dashboard Cards */
    .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 25px;
        margin-bottom: 40px;
    }

    .dashboard-card {
        background: var(--card-bg);
        backdrop-filter: blur(10px);
        border: var(--border);
        border-radius: 30px;
        padding: 30px;
        box-shadow: var(--shadow);
        transition: var(--transition-bounce);
        position: relative;
        overflow: hidden;
        cursor: pointer;
    }

    .dashboard-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 30px 60px rgba(108, 92, 231, 0.3);
    }

    .dashboard-card::before {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        width: 100px;
        height: 100px;
        background: linear-gradient(135deg, #6c5ce7, #a363d9);
        opacity: 0.1;
        border-radius: 0 0 0 100%;
    }

    .card-header {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 20px;
    }

    .card-icon {
        width: 60px;
        height: 60px;
        line-height: 60px;
        text-align: center;
        background: linear-gradient(135deg, #6c5ce7, #a363d9);
        color: white;
        border-radius: 20px;
        font-size: 1.8rem;
        transition: var(--transition-bounce);
    }

    .dashboard-card:hover .card-icon {
        transform: scale(1.1) rotate(10deg);
    }

    .card-title {
        font-size: 1.3rem;
        font-weight: 600;
        color: var(--text-primary);
        margin: 0;
    }

    .card-subtitle {
        color: var(--text-secondary);
        font-size: 0.9rem;
        margin: 0;
    }

    .card-actions {
        display: flex;
        gap: 10px;
        margin-top: 20px;
    }

    .btn-card {
        flex: 1;
        padding: 12px 20px;
        border-radius: 20px;
        font-weight: 600;
        border: none;
        cursor: pointer;
        transition: var(--transition-bounce);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
    }

    .btn-primary-action {
        background: linear-gradient(135deg, #6c5ce7, #a363d9);
        color: white;
    }

    .btn-secondary-action {
        background: var(--card-bg);
        border: 2px solid #6c5ce7;
        color: #6c5ce7;
    }

    .dashboard-card:hover .btn-primary-action {
        transform: translateY(-3px);
        box-shadow: 0 10px 20px rgba(108, 92, 231, 0.4);
    }

    .dashboard-card:hover .btn-secondary-action {
        background: linear-gradient(135deg, #6c5ce7, #a363d9);
        color: white;
        transform: translateY(-3px);
    }

    /* Stats Section */
    .stats-section {
        background: var(--card-bg);
        border: var(--border);
        border-radius: 30px;
        padding: 30px;
        margin-bottom: 40px;
        box-shadow: var(--shadow);
    }

    .stats-title {
        font-size: 1.4rem;
        font-weight: 600;
        margin-bottom: 25px;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .stats-title i {
        color: #6c5ce7;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
    }

    .stat-item {
        background: rgba(108, 92, 231, 0.05);
        border-radius: 20px;
        padding: 20px;
        text-align: center;
        transition: var(--transition-smooth);
    }

    .stat-item:hover {
        background: rgba(108, 92, 231, 0.1);
        transform: translateY(-5px);
    }

    .stat-value {
        font-size: 2rem;
        font-weight: 700;
        color: #6c5ce7;
        margin-bottom: 5px;
    }

    .stat-label {
        color: var(--text-secondary);
        font-size: 0.9rem;
    }

    /* Quick Actions */
    .quick-actions {
        background: var(--card-bg);
        border: var(--border);
        border-radius: 30px;
        padding: 30px;
        box-shadow: var(--shadow);
    }

    .quick-actions-title {
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 20px;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .quick-actions-title i {
        color: #6c5ce7;
    }

    .quick-actions-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
    }

    .quick-action-card {
        background: rgba(108, 92, 231, 0.05);
        border-radius: 20px;
        padding: 20px;
        border: 2px solid transparent;
        transition: var(--transition-smooth);
        cursor: pointer;
    }

    .quick-action-card:hover {
        border-color: #6c5ce7;
        background: rgba(108, 92, 231, 0.1);
        transform: translateY(-5px);
    }

    .quick-action-icon {
        width: 50px;
        height: 50px;
        line-height: 50px;
        text-align: center;
        background: linear-gradient(135deg, #6c5ce7, #a363d9);
        color: white;
        border-radius: 15px;
        font-size: 1.4rem;
        margin-bottom: 15px;
        transition: var(--transition-bounce);
    }

    .quick-action-card:hover .quick-action-icon {
        transform: scale(1.1);
    }

    .quick-action-title {
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 5px;
    }

    .quick-action-desc {
        color: var(--text-secondary);
        font-size: 0.9rem;
    }

    /* Classes & Subjects Lists */
    .list-section {
        background: var(--card-bg);
        border: var(--border);
        border-radius: 30px;
        padding: 30px;
        margin-bottom: 40px;
        box-shadow: var(--shadow);
    }

    .list-title {
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 20px;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .list-title i {
        color: #6c5ce7;
    }

    .list-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
    }

    .list-item {
        background: rgba(108, 92, 231, 0.05);
        border-radius: 20px;
        padding: 20px;
        border-left: 4px solid #6c5ce7;
        transition: var(--transition-smooth);
        cursor: pointer;
    }

    .list-item:hover {
        background: rgba(108, 92, 231, 0.1);
        transform: translateX(5px);
    }

    .list-item-title {
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 5px;
    }

    .list-item-subtitle {
        color: var(--text-secondary);
        font-size: 0.9rem;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .header-title {
            font-size: 2rem;
        }

        .dashboard-grid {
            grid-template-columns: 1fr;
        }

        .card-actions {
            flex-direction: column;
        }

        .btn-card {
            width: 100%;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Page Header -->
<section class="page-header">
    <div class="container header-content">
        <h1 class="header-title animate__animated animate__fadeInDown">
            <i class="fas fa-edit me-3"></i>Score Entry
        </h1>
        <p class="header-subtitle animate__animated animate__fadeInUp">
            Record and manage student scores for assessments and exams
        </p>
    </div>
</section>

<div class="container">
    <!-- Dashboard Cards -->
    <div class="dashboard-grid">
        <div class="dashboard-card animate__animated animate__fadeInUp" onclick="location.href='{% url 'academics:bulk_score_entry' %}'">
            <div class="card-header">
                <div class="card-icon">
                    <i class="fas fa-upload"></i>
                </div>
                <div>
                    <h3 class="card-title">Bulk Score Entry</h3>
                    <p class="card-subtitle">Upload scores for entire classes at once</p>
                </div>
            </div>
            <div class="card-actions">
                <button class="btn-card btn-primary-action">
                    <i class="fas fa-plus"></i>
                    <span>Start Bulk Entry</span>
                </button>
                <button class="btn-card btn-secondary-action" onclick="event.stopPropagation(); location.href='{% url 'academics:score_entry' %}'">
                    <i class="fas fa-list"></i>
                    <span>View Classes</span>
                </button>
            </div>
        </div>

        <div class="dashboard-card animate__animated animate__fadeInUp animate__delay-1s" onclick="location.href='{% url 'academics:individual_score_entry' %}'">
            <div class="card-header">
                <div class="card-icon">
                    <i class="fas fa-user-edit"></i>
                </div>
                <div>
                    <h3 class="card-title">Individual Score Entry</h3>
                    <p class="card-subtitle">Enter scores for individual students</p>
                </div>
            </div>
            <div class="card-actions">
                <button class="btn-card btn-primary-action">
                    <i class="fas fa-plus"></i>
                    <span>Add Individual Score</span>
                </button>
                <button class="btn-card btn-secondary-action" onclick="event.stopPropagation(); location.href='{% url 'academics:edit_scores' 1 1 %}'">
                    <i class="fas fa-edit"></i>
                    <span>Edit Existing</span>
                </button>
            </div>
        </div>

        <div class="dashboard-card animate__animated animate__fadeInUp animate__delay-2s" onclick="location.href='{% url 'academics:report_card_list' 1 %}'">
            <div class="card-header">
                <div class="card-icon">
                    <i class="fas fa-file-alt"></i>
                </div>
                <div>
                    <h3 class="card-title">Report Cards</h3>
                    <p class="card-subtitle">Generate and manage student report cards</p>
                </div>
            </div>
            <div class="card-actions">
                <button class="btn-card btn-primary-action">
                    <i class="fas fa-file-pdf"></i>
                    <span>Generate Reports</span>
                </button>
                <button class="btn-card btn-secondary-action" onclick="event.stopPropagation(); location.href='{% url 'academics:report_card_list' 1 %}'">
                    <i class="fas fa-eye"></i>
                    <span>View Reports</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Stats Section -->
    <div class="stats-section animate__animated animate__fadeInUp">
        <h3 class="stats-title">
            <i class="fas fa-chart-line"></i>
            Your Teaching Overview
        </h3>
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-value">{{ subjects_taught.count }}</div>
                <div class="stat-label">Subjects Taught</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">{{ classes_taught.count }}</div>
                <div class="stat-label">Classes</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">156</div>
                <div class="stat-label">Students</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">24</div>
                <div class="stat-label">Pending Reviews</div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions animate__animated animate__fadeInUp">
        <h3 class="quick-actions-title">
            <i class="fas fa-bolt"></i>
            Quick Actions
        </h3>
        <div class="quick-actions-grid">
            <div class="quick-action-card" onclick="location.href='{% url 'academics:bulk_score_entry' %}'">
                <div class="quick-action-icon">
                    <i class="fas fa-upload"></i>
                </div>
                <div class="quick-action-title">Upload CSV Scores</div>
                <div class="quick-action-desc">Import scores from Excel or CSV files</div>
            </div>
            <div class="quick-action-card" onclick="location.href='{% url 'academics:edit_scores' 1 1 %}'">
                <div class="quick-action-icon">
                    <i class="fas fa-edit"></i>
                </div>
                <div class="quick-action-title">Edit Scores</div>
                <div class="quick-action-desc">Modify existing student scores</div>
            </div>
            <div class="quick-action-card" onclick="location.href='{% url 'academics:approve_scores' 1 1 %}'">
                <div class="quick-action-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="quick-action-title">Approve Scores</div>
                <div class="quick-action-desc">Review and approve pending scores</div>
            </div>
            <div class="quick-action-card" onclick="location.href='{% url 'academics:generate_report_cards' %}'">
                <div class="quick-action-icon">
                    <i class="fas fa-file-pdf"></i>
                </div>
                <div class="quick-action-title">Generate Reports</div>
                <div class="quick-action-desc">Create report cards for your classes</div>
            </div>
        </div>
    </div>

    <!-- Classes You Teach -->
    {% if classes_taught %}
        <div class="list-section animate__animated animate__fadeInUp">
            <h3 class="list-title">
                <i class="fas fa-school"></i>
                Classes You Teach
            </h3>
            <div class="list-grid">
                {% for class_obj in classes_taught %}
                    <div class="list-item" onclick="location.href='{% url 'academics:edit_scores' class_obj.id 1 %}'">
                        <div class="list-item-title">{{ class_obj.name }}</div>
                        <div class="list-item-subtitle">
                            <i class="fas fa-users me-2"></i>
                            {{ class_obj.student_set.filter(enrollment_status='ACTIVE').count }} students
                        </div>
                        <div class="list-item-subtitle mt-2">
                            <i class="fas fa-chalkboard-teacher me-2"></i>
                            Class Teacher: {{ class_obj.class_teacher.get_full_name|default:"You" }}
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    {% endif %}

    <!-- Subjects You Teach -->
    {% if subjects_taught %}
        <div class="list-section animate__animated animate__fadeInUp">
            <h3 class="list-title">
                <i class="fas fa-book"></i>
                Subjects You Teach
            </h3>
            <div class="list-grid">
                {% for subject in subjects_taught %}
                    <div class="list-item" onclick="location.href='{% url 'academics:bulk_score_entry' %}?subject_id={{ subject.id }}'">
                        <div class="list-item-title">{{ subject.name }}</div>
                        <div class="list-item-subtitle">
                            <i class="fas fa-layer-group me-2"></i>
                            {{ subject.class_level.name }}
                        </div>
                        <div class="list-item-subtitle mt-2">
                            <i class="fas fa-calendar-alt me-2"></i>
                            Current Term: {{ subject.subjectassessment_set.filter(academic_year__is_current=True).count }} assessments
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    {% endif %}

    <!-- Recent Activity -->
    <div class="list-section animate__animated animate__fadeInUp">
        <h3 class="list-title">
            <i class="fas fa-history"></i>
            Recent Activity
        </h3>
        <div class="list-grid">
            <div class="list-item">
                <div class="list-item-title">Mathematics Scores Updated</div>
                <div class="list-item-subtitle">
                    <i class="fas fa-clock me-2"></i>
                    2 hours ago
                </div>
                <div class="list-item-subtitle mt-2">
                    <i class="fas fa-users me-2"></i>
                    JSS 2A - 32 students
                </div>
            </div>
            <div class="list-item">
                <div class="list-item-title">English Test Scores Uploaded</div>
                <div class="list-item-subtitle">
                    <i class="fas fa-clock me-2"></i>
                    4 hours ago
                </div>
                <div class="list-item-subtitle mt-2">
                    <i class="fas fa-users me-2"></i>
                    SS 1B - 28 students
                </div>
            </div>
            <div class="list-item">
                <div class="list-item-title">Report Cards Generated</div>
                <div class="list-item-subtitle">
                    <i class="fas fa-clock me-2"></i>
                    Yesterday
                </div>
                <div class="list-item-subtitle mt-2">
                    <i class="fas fa-users me-2"></i>
                    JSS 3A - 25 students
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Loading Modal -->
<div class="modal fade" id="loadingModal" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered modal-sm">
        <div class="modal-content text-center p-4">
            <div class="spinner-border text-primary mb-3" style="width: 3rem; height: 3rem;" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <h5>Processing</h5>
            <p class="text-secondary small">Please wait while we load your data...</p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Card hover effects
    document.querySelectorAll('.dashboard-card').forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-15px) scale(1.02)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(-10px) scale(1)';
        });
    });

    // List item hover effects
    document.querySelectorAll('.list-item').forEach(item => {
        item.addEventListener('mouseenter', function() {
            this.style.transform = 'translateX(10px) scale(1.01)';
        });
        
        item.addEventListener('mouseleave', function() {
            this.style.transform = 'translateX(0) scale(1)';
        });
    });

    // Quick action hover effects
    document.querySelectorAll('.quick-action-card').forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-8px) scale(1.02)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0) scale(1)';
        });
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        // Ctrl + B for bulk entry
        if (e.ctrlKey && e.key === 'b') {
            e.preventDefault();
            location.href = "{% url 'academics:bulk_score_entry' %}";
        }
        
        // Ctrl + I for individual entry
        if (e.ctrlKey && e.key === 'i') {
            e.preventDefault();
            location.href = "{% url 'academics:individual_score_entry' %}";
        }
        
        // Ctrl + R for report cards
        if (e.ctrlKey && e.key === 'r') {
            e.preventDefault();
            location.href = "{% url 'academics:report_card_list' 1 %}";
        }
    });

    // Initialize tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function(tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });

    // Animate stats on scroll
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const statValues = entry.target.querySelectorAll('.stat-value');
                statValues.forEach(stat => {
                    const value = parseInt(stat.innerText);
                    let current = 0;
                    const increment = value / 50;
                    
                    const timer = setInterval(() => {
                        current += increment;
                        if (current >= value) {
                            current = value;
                            clearInterval(timer);
                        }
                        stat.innerText = Math.floor(current);
                    }, 20);
                });
                
                observer.unobserve(entry.target);
            }
        });
    }, observerOptions);

    document.querySelectorAll('.stats-section').forEach(section => {
        observer.observe(section);
    });

    // Show loading modal for slow operations
    document.querySelectorAll('.dashboard-card').forEach(card => {
        card.addEventListener('click', function() {
            const modal = new bootstrap.Modal(document.getElementById('loadingModal'));
            modal.show();
            
            setTimeout(() => {
                modal.hide();
            }, 1000);
        });
    });
</script>
{% endblock %}