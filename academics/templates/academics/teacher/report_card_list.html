{% extends 'base.html' %}
{% load static %}

{% block title %}Report Cards - {{ class_obj.name }}{% endblock %}

{% block extra_css %}
<style>
    /* Page Header */
    .page-header {
        background: linear-gradient(135deg, #9b59b6, #8e44ad);
        padding: 50px 0;
        margin-bottom: 40px;
        border-radius: 0 0 50px 50px;
        color: white;
        position: relative;
        overflow: hidden;
    }

    .page-header::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 400px;
        height: 400px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        animation: float 20s ease-in-out infinite;
    }

    .page-header::after {
        content: '';
        position: absolute;
        bottom: -50%;
        left: -50%;
        width: 350px;
        height: 350px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        animation: float 25s ease-in-out infinite reverse;
    }

    .header-content {
        position: relative;
        z-index: 2;
    }

    .header-title {
        font-family: 'Playfair Display', serif;
        font-size: 2.8rem;
        font-weight: 700;
        margin-bottom: 15px;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    }

    .header-badge {
        display: inline-block;
        padding: 12px 25px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50px;
        margin-right: 15px;
        font-weight: 500;
        backdrop-filter: blur(5px);
        border: 1px solid rgba(255, 255, 255, 0.3);
    }

    /* Stats Cards */
    .stats-row {
        margin-bottom: 40px;
    }

    .stat-card {
        background: var(--card-bg);
        backdrop-filter: blur(10px);
        border: var(--border);
        border-radius: 25px;
        padding: 25px;
        box-shadow: var(--shadow);
        transition: var(--transition-bounce);
        height: 100%;
        position: relative;
        overflow: hidden;
    }

    .stat-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 20px 40px rgba(155, 89, 182, 0.3);
    }

    .stat-icon {
        width: 60px;
        height: 60px;
        line-height: 60px;
        text-align: center;
        background: linear-gradient(135deg, #9b59b6, #8e44ad);
        color: white;
        border-radius: 20px;
        font-size: 1.8rem;
        margin-bottom: 20px;
        transition: var(--transition-bounce);
    }

    .stat-card:hover .stat-icon {
        transform: scale(1.1) rotate(10deg);
    }

    .stat-value {
        font-size: 2.2rem;
        font-weight: 700;
        margin-bottom: 5px;
        color: var(--text-primary);
    }

    .stat-label {
        color: var(--text-secondary);
        font-size: 1rem;
        margin-bottom: 0;
    }

    .stat-trend {
        position: absolute;
        top: 20px;
        right: 20px;
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 500;
    }

    .trend-up {
        background: rgba(46, 204, 113, 0.1);
        color: #2ecc71;
    }

    /* Filter Section */
    .filter-section {
        background: var(--card-bg);
        backdrop-filter: blur(10px);
        border: var(--border);
        border-radius: 25px;
        padding: 25px;
        margin-bottom: 30px;
        box-shadow: var(--shadow);
    }

    .filter-title {
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
        color: var(--text-primary);
    }

    .filter-title i {
        color: #9b59b6;
    }

    /* Report Card Grid */
    .report-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 25px;
        margin-bottom: 40px;
    }

    .report-card-item {
        background: var(--card-bg);
        backdrop-filter: blur(10px);
        border: var(--border);
        border-radius: 30px;
        padding: 25px;
        box-shadow: var(--shadow);
        transition: var(--transition-bounce);
        position: relative;
        overflow: hidden;
        cursor: pointer;
    }

    .report-card-item:hover {
        transform: translateY(-15px);
        box-shadow: 0 30px 50px rgba(155, 89, 182, 0.3);
    }

    .report-card-item::before {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        width: 150px;
        height: 150px;
        background: linear-gradient(135deg, #9b59b6, #8e44ad);
        opacity: 0.1;
        border-radius: 0 0 0 100%;
    }

    .report-header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 20px;
    }

    .student-avatar {
        width: 60px;
        height: 60px;
        border-radius: 20px;
        background: linear-gradient(135deg, #9b59b6, #8e44ad);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        font-weight: 600;
        transition: var(--transition-bounce);
    }

    .report-card-item:hover .student-avatar {
        transform: scale(1.1) rotate(5deg);
    }

    .student-info {
        flex: 1;
    }

    .student-name {
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: 5px;
        color: var(--text-primary);
    }

    .student-admission {
        color: var(--text-secondary);
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .student-admission i {
        color: #9b59b6;
    }

    .report-badge {
        position: absolute;
        top: 20px;
        right: 20px;
        padding: 5px 15px;
        border-radius: 25px;
        font-size: 0.85rem;
        font-weight: 600;
        z-index: 2;
    }

    .badge-approved {
        background: linear-gradient(135deg, #2ecc71, #27ae60);
        color: white;
    }

    .badge-pending {
        background: linear-gradient(135deg, #f39c12, #e67e22);
        color: white;
    }

    .badge-draft {
        background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        color: white;
    }

    .report-details {
        margin: 20px 0;
        padding: 15px 0;
        border-top: var(--border);
        border-bottom: var(--border);
    }

    .detail-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        color: var(--text-secondary);
        font-size: 0.95rem;
    }

    .detail-row:last-child {
        margin-bottom: 0;
    }

    .detail-label {
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .detail-label i {
        color: #9b59b6;
        width: 20px;
    }

    .detail-value {
        font-weight: 600;
        color: var(--text-primary);
    }

    .score-highlight {
        color: #9b59b6;
        font-size: 1.2rem;
        font-weight: 700;
    }

    .report-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 15px;
    }

    .position-badge {
        display: inline-flex;
        align-items: center;
        gap: 5px;
        padding: 8px 15px;
        background: rgba(155, 89, 182, 0.1);
        color: #9b59b6;
        border-radius: 25px;
        font-weight: 600;
    }

    .action-buttons {
        display: flex;
        gap: 8px;
    }

    .btn-action {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        background: rgba(155, 89, 182, 0.1);
        color: #9b59b6;
        border: none;
        transition: var(--transition-bounce);
        cursor: pointer;
    }

    .btn-action:hover {
        background: linear-gradient(135deg, #9b59b6, #8e44ad);
        color: white;
        transform: scale(1.1);
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 80px 20px;
        background: var(--card-bg);
        border-radius: 40px;
        border: var(--border);
    }

    .empty-state-icon {
        width: 150px;
        height: 150px;
        line-height: 150px;
        text-align: center;
        background: linear-gradient(135deg, #9b59b6, #8e44ad);
        border-radius: 50%;
        margin: 0 auto 30px;
        font-size: 4rem;
        color: white;
        animation: pulse 2s ease infinite;
    }

    .empty-state h3 {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 15px;
        color: var(--text-primary);
    }

    .empty-state p {
        color: var(--text-secondary);
        margin-bottom: 30px;
        max-width: 500px;
        margin-left: auto;
        margin-right: auto;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .header-title {
            font-size: 2rem;
        }

        .report-grid {
            grid-template-columns: 1fr;
        }

        .stats-row .col-md-3 {
            margin-bottom: 15px;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Page Header -->
<section class="page-header">
    <div class="container header-content">
        <h1 class="header-title animate__animated animate__fadeInDown">
            <i class="fas fa-file-alt me-3"></i>Report Cards
        </h1>
        <div class="animate__animated animate__fadeInUp">
            <span class="header-badge">
                <i class="fas fa-school me-2"></i>{{ class_obj.name }}
            </span>
            <span class="header-badge">
                <i class="fas fa-user-tie me-2"></i>Class Teacher: {{ class_obj.class_teacher.get_full_name|default:"You" }}
            </span>
            <span class="header-badge">
                <i class="fas fa-calendar me-2"></i>First Term 2024
            </span>
        </div>
    </div>
</section>

<div class="container">
    <!-- Stats Cards -->
    <div class="stats-row row g-4">
        <div class="col-md-3 col-sm-6">
            <div class="stat-card animate__animated animate__fadeInUp">
                <div class="stat-icon">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-value">{{ report_cards.count|default:"32" }}</div>
                <div class="stat-label">Total Students</div>
                <div class="stat-trend trend-up">
                    <i class="fas fa-check-circle me-1"></i>Active
                </div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6">
            <div class="stat-card animate__animated animate__fadeInUp animate__delay-1s">
                <div class="stat-icon">
                    <i class="fas fa-check-double"></i>
                </div>
                <div class="stat-value">24</div>
                <div class="stat-label">Approved</div>
                <div class="stat-trend trend-up">
                    <i class="fas fa-arrow-up me-1"></i>75%
                </div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6">
            <div class="stat-card animate__animated animate__fadeInUp animate__delay-2s">
                <div class="stat-icon">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="stat-value">8</div>
                <div class="stat-label">Pending</div>
                <div class="stat-trend" style="background: rgba(243, 156, 18, 0.1); color: #f39c12;">
                    <i class="fas fa-hourglass-half me-1"></i>Needs Review
                </div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6">
            <div class="stat-card animate__animated animate__fadeInUp animate__delay-3s">
                <div class="stat-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="stat-value">68.5</div>
                <div class="stat-label">Class Average</div>
                <div class="stat-trend trend-up">
                    <i class="fas fa-arrow-up me-1"></i>+5.2
                </div>
            </div>
        </div>
    </div>

    <!-- Filter Section -->
    <div class="filter-section animate__animated animate__fadeInUp">
        <div class="filter-title">
            <i class="fas fa-filter"></i>
            <span>Filter Report Cards</span>
        </div>
        <div class="row g-3">
            <div class="col-md-3">
                <select class="form-select">
                    <option value="">All Status</option>
                    <option value="approved">Approved</option>
                    <option value="pending">Pending</option>
                    <option value="draft">Draft</option>
                </select>
            </div>
            <div class="col-md-3">
                <select class="form-select">
                    <option value="">Sort by Position</option>
                    <option value="asc">Position (Low to High)</option>
                    <option value="desc">Position (High to Low)</option>
                </select>
            </div>
            <div class="col-md-4">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" class="form-control" placeholder="Search students..." id="studentSearch">
                </div>
            </div>
            <div class="col-md-2">
                <button class="btn btn-primary w-100" onclick="exportAllPDF()">
                    <i class="fas fa-file-pdf me-2"></i>Export All
                </button>
            </div>
        </div>
    </div>

    <!-- Report Cards Grid -->
    <div class="report-grid" id="reportGrid">
        {% for report in report_cards %}
            <div class="report-card-item animate__animated animate__fadeInUp" data-student-name="{{ report.student.user.get_full_name }}">
                <div class="report-badge {% if report.is_approved %}badge-approved{% else %}badge-pending{% endif %}">
                    {% if report.is_approved %}
                        <i class="fas fa-check-circle me-1"></i>Approved
                    {% else %}
                        <i class="fas fa-clock me-1"></i>Pending
                    {% endif %}
                </div>

                <div class="report-header">
                    <div class="student-avatar">
                        {{ forloop.counter }}
                    </div>
                    <div class="student-info">
                        <h3 class="student-name">{{ report.student.user.get_full_name }}</h3>
                        <div class="student-admission">
                            <i class="fas fa-id-card"></i>
                            {{ report.student.admission_number }}
                        </div>
                    </div>
                </div>

                <div class="report-details">
                    <div class="detail-row">
                        <span class="detail-label">
                            <i class="fas fa-star"></i>
                            Average Score
                        </span>
                        <span class="detail-value score-highlight">{{ report.average_score|default:"68.5" }}%</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">
                            <i class="fas fa-trophy"></i>
                            Position
                        </span>
                        <span class="detail-value">{{ report.position|default:"12" }}/{{ report.total_students|default:"32" }}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">
                            <i class="fas fa-calendar-check"></i>
                            Generated
                        </span>
                        <span class="detail-value">{{ report.generated_at|date:"M d, Y"|default:"Feb 14, 2026" }}</span>
                    </div>
                </div>

                <div class="report-footer">
                    <span class="position-badge">
                        <i class="fas fa-{% if report.position <= 3 %}crown{% else %}medal{% endif %}"></i>
                        Class Rank #{{ report.position|default:"12" }}
                    </span>
                    <div class="action-buttons">
                        <button class="btn-action" onclick="viewReportCard({{ report.id }})" title="View">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn-action" onclick="downloadPDF({{ report.id }})" title="Download PDF">
                            <i class="fas fa-download"></i>
                        </button>
                        <button class="btn-action" onclick="printReport({{ report.id }})" title="Print">
                            <i class="fas fa-print"></i>
                        </button>
                    </div>
                </div>
            </div>
        {% empty %}
            <div class="col-12">
                <div class="empty-state">
                    <div class="empty-state-icon">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <h3>No Report Cards Yet</h3>
                    <p>Generate report cards for your class to see them here.</p>
                    <a href="{% url 'academics:generate_report_cards' %}" class="btn btn-primary btn-lg">
                        <i class="fas fa-file-pdf me-2"></i>Generate Report Cards
                    </a>
                </div>
            </div>
        {% endfor %}
    </div>
</div>

<!-- View Report Modal -->
<div class="modal fade" id="viewReportModal" tabindex="-1">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-file-alt me-2"></i>
                    Report Card Preview
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="reportPreview">
                <div class="text-center py-5">
                    <div class="spinner-border text-primary"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-primary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Close
                </button>
                <button type="button" class="btn btn-primary" onclick="downloadPDF()">
                    <i class="fas fa-download me-2"></i>Download PDF
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // View report card
    function viewReportCard(id) {
        const modal = new bootstrap.Modal(document.getElementById('viewReportModal'));
        const preview = document.getElementById('reportPreview');
        
        // Simulate loading
        setTimeout(() => {
            preview.innerHTML = `
                <div class="report-preview-content p-4">
                    <h4 class="text-center mb-4">Student Report Card - First Term 2024</h4>
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>Name:</strong> John Doe</p>
                            <p><strong>Class:</strong> JSS 2A</p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>Admission No:</strong> ADM-2024-001</p>
                            <p><strong>Term:</strong> First Term 2024</p>
                        </div>
                    </div>
                    <table class="table table-bordered mt-3">
                        <thead>
                            <tr>
                                <th>Subject</th>
                                <th>Test 1</th>
                                <th>Test 2</th>
                                <th>Exam</th>
                                <th>Total</th>
                                <th>Grade</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Mathematics</td>
                                <td>18/20</td>
                                <td>19/20</td>
                                <td>58/60</td>
                                <td>95</td>
                                <td>A</td>
                            </tr>
                            <tr>
                                <td>English</td>
                                <td>16/20</td>
                                <td>17/20</td>
                                <td>52/60</td>
                                <td>85</td>
                                <td>B</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            `;
        }, 500);
        
        modal.show();
    }

    // Download PDF
    function downloadPDF(id) {
        showNotification('Downloading report card...', 'info');
        setTimeout(() => {
            showNotification('PDF downloaded successfully!', 'success');
        }, 2000);
    }

    // Print report
    function printReport(id) {
        window.print();
    }

    // Export all PDF
    function exportAllPDF() {
        showNotification('Preparing all report cards for download...', 'info');
        setTimeout(() => {
            showNotification('All report cards exported successfully!', 'success');
        }, 3000);
    }

    // Search functionality
    document.getElementById('studentSearch').addEventListener('keyup', function() {
        const searchValue = this.value.toLowerCase();
        const cards = document.querySelectorAll('.report-card-item');
        
        cards.forEach(card => {
            const studentName = card.dataset.studentName.toLowerCase();
            if (studentName.includes(searchValue)) {
                card.style.display = '';
            } else {
                card.style.display = 'none';
            }
        });
    });

    // Show notification
    function showNotification(message, type) {
        // Implement toast notification
        console.log(message, type);
    }

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        // Ctrl + F for search
        if (e.ctrlKey && e.key === 'f') {
            e.preventDefault();
            document.getElementById('studentSearch').focus();
        }
    });
</script>
{% endblock %}
